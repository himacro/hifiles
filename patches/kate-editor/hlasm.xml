<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE language SYSTEM "language.dtd">
<language name="hlasm" version="0.01" kateversion="3.10" section="Assembler" extensions="*.s" mimetype="text/x-hlasm">
  <highlighting>
    <list name="structure">
      <item>IF</item>
      <item>ENDIF</item>
      <item>AND</item>
      <item>OR</item>
      <item>DO</item>
      <item>ENDO</item>
      <item>CASE</item>
      <item>ENDCASE</item>
      <item>WHEN</item>
    </list>
    <contexts>
      <!-- Start of one statement -->
      <context name="default" attribute="normal" lineEndContext="#pop">
	<DetectChar char="*" attribute="comment" context="line comment" column="0"/>
	<Detect2Chars char="." char1="*" attribute="comment" context="line comment" column="0"/>
	<RegExpr String="^\S+" attribute="entry" column="0"/>
	<DetectSpaces context="opcode"/>
      </context>
      <!-- Line comment -->
      <context name="line comment" attribute="comment" lineEndContext="#pop"/>
      <!-- Expecting the op-code -->
      <context name="opcode" attribute="opcode" lineEndContext="#pop">
	<keyword String="structure" attribute="structure_macro"/>
	<RegExpr String="[@#]\S+" attribute="hrm_macro"/>
	<RegExpr String="\S+"/>
	<DetectSpaces context="operands"/>
      </context>
      <!-- Expecting the operands -->
      <context name="operands" attribute="operands" lineEndContext="#pop#pop" >
	<Detect2Chars char="L" char1="'" attribute="attr" />
	<DetectChar char="'" attribute="string" context="string"/>
	<DetectSpaces context="comment"/>
      </context>
      <!-- Check the contiunation flag -->
      <context name="comment" attribute="comment" lineEndContext="#pop#pop#pop" >
	<RegExpr String="\S" attribute="cont_flag" column="71" context="continuation"/>
      </context>
      <!-- Continuation -->
      <context name="continuation" attribute="comment" lineEndContext="#stay">
	<RegExpr String="^-\s+" context="#pop#pop#pop!operands"/>
	<RegExpr String="^\s{15}" context="#pop#pop#pop!operands"/>
      </context>
      <context name="string" attribute="string" lineEndContext="#stay">
	<DetectChar char="'" attribute="string" context="#pop"/>
      </context>
    </contexts>
    <itemDatas>
      <itemData name="normal" defStyleNum="dsNormal" />
      <itemData name="entry" defStyleNum="dsFunction" />
      <itemData name="opcode" defStyleNum="dsOthers" />
      <itemData name="operand" defStyleNum="dsNormal" />
      <itemData name="comment" defStyleNum="dsComment" />
      <itemData name="cont_flag" defStyleNum="dsAlert" />
      <itemData name="string" defStyleNum="dsString" />
      <itemData name="attr" defStyleNum="dsNormal" />
      <itemData name="hrm_macro" defStyleNum="dsChar" />
      <itemData name="structure_macro" defStyleNum="dsKeyword" />
    </itemDatas>
  </highlighting>
</language>